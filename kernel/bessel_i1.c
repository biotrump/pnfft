/*
 * Copyright (c) 2002, 2009 Jens Keiner, Stefan Kunis, Daniel Potts
 * Copyright (c) 2011-2013 Michael Pippig
 *
 * This file is part of PNFFT.
 *
 * PNFFT is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * PNFFT is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with PNFFT.  If not, see <http://www.gnu.org/licenses/>.
 *
 */

#include "pnfft.h"
#include "ipnfft.h"
#include "bessel_i1.h"

#if defined(PNFFT_LDOUBLE)
  #if LDBL_MANT_DIG > 64
    /* long double 128 bit wide */
    /* Coefficients generated with Mathematica for quadruple precision */
    static const R P1[] =
    {
      /* Numerator Chebyshev coefficients on Intervall [-1,1], QuadruplePrecision */
//       K(0.5011456565547871651833123808939630885616304571922247462124227299),
//       K(0.0599735126707040879380378840397479016726522558795874237907009632),
//       K(0.0011457107246106225368011811673101280883681440330120170780315712),
//       K(0.0000104355581002215083222694805756339007800121612837004340952475),
//       K(5.41702131493563338437516627632186678489333748726039231255e-8),
//       K(1.772627895877553293474995386858630726550512735217448732e-10),
//       K(3.896926696520436244352576202663008812394421353487752e-13),
//       K(6.003805787302249669865016780779837795160881095518e-16),
//       K(6.668073282200833488298100877470512242002226695e-19),
//       K(5.435058332940063024030239174900692254549542e-22),
//       K(3.280740119248573379937740530760946077811e-25),
//       K(1.467020192701651873950165951939958017e-28),
//       K(4.81099576676090004194553403167944e-32),
//       K(1.12883721401699880657514396703e-35),
//       K(1.8028475769487687052782554e-39),
//       K(1.766045467767437849463e-43),
//       K(8.0632270900381601e-48)

      /* Numerator Chebyshev coefficients on Intervall [0,225], QuadruplePrecision */
      K(1665.680009904850713295143667253354527427765922503033211671480545),
      K(2767.437637744957257962427013779535851868321256940008184744561871),
      K(1598.531123309947768848192016437607790124319291863452484178035809),
      K(652.993687307729688041661295801280761409427782473949820185153123),
      K(192.38738013021491524135916689403428966634481382082252617372169),
      K(41.645155798354385071687419962635410170619053014598300191108733),
      K(6.727861732599695702928266625860785077386192519023204334357564),
      K(0.821076268791752103679711365516999715358668734789744828635686),
      K(0.076324795246687157899494138328356925088286549134230439158672),
      K(0.005425637358671837857063845221841516507309964266194061629345),
      K(0.000294656948906146175583235862845060610167355927799997408661),
      K(0.000012137685343038865027077274224476647311951439848527283106),
      K(3.73263141173461598054644150341470845788323850629055611e-7),
      K(8.320944459468407384052052829231889133474933785598852e-9),
      K(1.27412956022929947696951711055591822724494783191988e-10),
      K(1.203313760896130862055440687392507520751691694013e-12),
      K(5.308224112758989501092759553214221856030687845e-15)
    };
    static const R Q1[] =
    {
      /* Denominator Chebyshev coefficients on Intervall [-1,1], QuadruplePrecision */
//       K(1.000006545578132971746649350432924180289325656798935233473012293946),
//       K(-0.005115602947338779165701475612584696741653443449043212816725008458),
//       K(6.545581669068823868669953901580684021286689257777055198931034e-6),
//       K(-5.570924669116347568537699130262554489734508407556173396774e-9),
//       K(3.536097811340668196882598485480695186663795617899585396e-12),
//       K(-1.778159949011550380727945461692876199421752776680429e-15),
//       K(7.34121423519681940564727179621184929010451599718e-19),
//       K(-2.54307316291882328872956555730929693807147213e-22),
//       K(7.4843780774673876393636860681739772897613e-26),
//       K(-1.8811631098316345279061351748593952328e-29),
//       K(4.032200044192273756465775615397386e-33),
//       K(-7.30646160340638456704945097622e-37),
//       K(1.09912962959650015927533616e-40),
//       K(-1.3291256577882796578126e-44),
//       K(1.220189007774588861e-48),
//       K(-7.6069716473727e-53),
//       K(2.428206429e-57)

      /* Denominator Chebyshev coefficients on Intervall [0,225], QuadruplePrecision */
      K(0.6100895701705707256843709090583765586820699564977173558180644582),
      K(-0.337100013733365251571986147170620770910929590999139041251977017),
      K(0.047898989391484945070612087784165713963240289447184669294783904),
      K(-0.004565814832494835715857979763774317468510066091691615225730281),
      K(0.00032617430627582913582171997551606885436453772092531397001072),
      K(-0.000018534004049156718224297677593732397015906056099298717852405),
      K(8.68105353796178670741430804950334680210522052589049489221e-7),
      K(-3.4267078788375028566351512187305575312248730874200813277e-8),
      K(1.155026906860300733347855489522561262117492702278902437e-9),
      K(-3.3449701450524105046784147845225855285992302843806126e-11),
      K(8.32092541561780012520590981123047478410004903319747e-13),
      K(-1.7651899965705511378817186382867730059314565375934e-14),
      K(3.14191817822734348903012717948788594147690846019e-16),
      K(-4.55395411834405736396172996600256074090096337e-18),
      K(5.0907697722851077576451343376686349644188439e-20),
      K(-3.93989518800097994455572044675647211841106e-22),
      K(1.598549039212002966267591988032432035537e-24)
    };
    static const R P2[] =
    {
      /* Numerator Chebyshev coefficients on Intervall [-1,1], QuadruplePrecision */
//       K(-4.902199823145214662062040062343601367537554957482791087698269298e24),
//       K(9.62251118658127520968861453603290507881169490491952501961547031e24),
//       K(-8.98675143991236008271855621377982698325650124403355822262745841e24),
//       K(8.08232781376300596373643383471714056586635824149796637616724229e24),
//       K(-6.91243652005845084464521448955848119584679878212430437513325967e24),
//       K(5.68835638161803455700892537901116049154660819523117379714429236e24),
//       K(-4.44543505880769276005999478566074131913709935129794686934024666e24),
//       K(3.33780682737108905505690670483420287423882845779067716598688405e24),
//       K(-2.37493025768172995035240029894849557239943374755955430480549843e24),
//       K(1.61978247573720647842388244481686935615309570732961629289645388e24),
//       K(-1.04369870409925387754548076667758878119654554438279510312572668e24),
//       K(6.4239548635532484413069826900754842819761740728483482016548062e23),
//       K(-3.7197803054987117246435347841709214596575771390227829316990807e23),
//       K(2.0467836896722564469697982839988891342766598801417779936041491e23),
//       K(-1.0535427428431911919938723723364431735614285715703391332170209e23),
//       K(5.111549604915199530718255925895239266973074835621068628165664e22),
//       K(-2.302310014854787262805870810354288969796069912449319362224691e22),
//       K(9.64551539861149226427024024010251653795263257775093721967073e21),
//       K(-3.71266169944774762981428415506356873282748950256990911130709e21),
//       K(1.29806554892244630005191724053493075906467096902914352152671e21),
//       K(-4.1093060427450832295111936325414101199558964872784312411124e20),
//       K(1.1260273491404924391670140345506552383833134189413367975615e20),
//       K(-2.731320959598893901011915969971455995935836651607926052075e19),
//       K(5.073105062809229567997966054166311099556517263834035150341e18),
//       K(-7.89824580565617224850989816970346896414952211064851799577e17),
//       K(5.4331545419976409952078538484022670082498442000908629252e16)

      /* Numerator Chebyshev coefficients on Intervall [0,1/15], QuadruplePrecision */
      K(0.05530410287436075723051419381885816282471791026198910832733),
      K(-0.10213331513241222437112033075218636049100389960311260160728),
      K(0.08639840393930944763600051146119829102412752534439799473049),
      K(-0.06337148518323857145218311037038486922777829393109951621535),
      K(0.04240587591788208634484573945112760504336979498929177100031),
      K(-0.02505708659732851171156529487822467253407477772690171032616),
      K(0.0134481896455294680957085980677409022048689456151084257434),
      K(-0.00643700752369480985442758917388594377647965655983901442289),
      K(0.00278400101647045962870072450307412742036267442559933278032),
      K(-0.00107527877459999379276286362315979291899509726766058004315),
      K(0.0003721908589765114034177501937366003571824979097268246209),
      K(-0.00011424226900290247445787118639593454339171100482052199547),
      K(0.00003097474230516430710016414920883766967239184299296160061),
      K(-7.31597602672818154718701783487221926057428604272508336e-6),
      K(1.48533625394227294492100053384128856292160460921042655e-6),
      K(-2.5266270510896852323844137502648198661275255150486272e-7),
      K(3.470280190287302719463869959876981981499603749657841e-8),
      K(-3.55932495402565065356680516584462289567101997573467e-9),
      K(2.1934730131244032727072649435366931056938704798996e-10),
      K(2.34619264877302766399700387349868075102268614845e-12),
      K(-2.14901247613437874802850463926829393304189432226e-12),
      K(2.2814401752778732073193396776498750981609185626e-13),
      K(-1.150957980284113413426642737890578220842852952e-14),
      K(2.6821268628712013123080060863593226278964534e-16),
      K(-2.47590773479524614055727062586416334500161e-18),
      K(6.41237720789906093490098432739522757944e-21)
    };
    static const R Q2[] =
    {
      /* Denominator Chebyshev coefficients on Intervall [-1,1], QuadruplePrecision */
//       K(-9.43207112217156577980814562881746106482583824589031075986478912e24),
//       K(1.859759233784860578430043231843374619502520871659194220937024342e25),
//       K(-1.72775846913720307012492392966771494056679286851283739499567807e25),
//       K(1.559870676518549022348608199923720627997764184912364089486085318e25),
//       K(-1.325824221817125168821081714295904045516231211255878761005517095e25),
//       K(1.094648995540771673566830590765357211972096821506060097372235559e25),
//       K(-8.49173193947492425942405411993651726037200610387939566460353977e24),
//       K(6.39394540979012841326106358520336225706333909444805813645009646e24),
//       K(-4.50927452317881320919927413723278122378097485111120378673250776e24),
//       K(3.08283923686944020161010409601263064765603676871528752527046315e24),
//       K(-1.96506889392360354974693923654042980274885258559118309407104494e24),
//       K(1.21188563374626499213600938019525254293258966772881136441079924e24),
//       K(-6.9240992883813662209727528820993112688939126655965904811306133e23),
//       K(3.8156622733955361688186490608018447501940073234959964005507344e23),
//       K(-1.9310390416702991954973396193191242747351697617903345870267468e23),
//       K(9.37666920580319620534624270662659020524760512639398384253258e22),
//       K(-4.131338443715921588938178965425860084900228898923405788821356e22),
//       K(1.729961388500740171162732053977714968551201883119969053727155e22),
//       K(-6.46443762816324221121932908712545975755442652550070958971687e21),
//       K(2.25149873060585351437658169460180580359610035183097742846663e21),
//       K(-6.8379075795461133244158343046170971696223694399247815268156e20),
//       K(1.8463663692862240773711246574528774959968791394167166623061e20),
//       K(-4.214903235567123429749244301736534022013105980708305085616e19),
//       K(7.33563940227116027757492488890414244328167417595285596091e18),
//       K(-1.04804322621687814686631221754013559790631010621916818884e18),
//       K(2.8168302086591428998717569619168941300030226037851722764e16)

      /* Denominator Chebyshev coefficients on Intervall [0,1/15], QuadruplePrecision */
      K(0.13876142827899036726953101108505904861336544594986668328082),
      K(-0.2561221011955954020861136114639963183023763792619903085054),
      K(0.2166847195766562881165492102814158093613686320268552144228),
      K(-0.1588149853038403219301212815383193655892329655976352053494),
      K(0.106239245466360940904299814824135876826203726980604111492),
      K(-0.0627182705037972961087492108914517387222545075503547826415),
      K(0.0336375754197468342208315667515463472776581687640629993427),
      K(-0.0160825407962442910275623050474165847610382576471588648303),
      K(0.0069480832782481111183807154062218525930229465202609467334),
      K(-0.0026796372973389461112518106804500196652941568413468538542),
      K(0.0009260226002193206696205575640515254091725205655678673892),
      K(-0.0002836540126960572482482031564739032154722225502014486349),
      K(0.0000767213607330456011037404904163935471387092813754182994),
      K(-0.0000180641814777283952425137949242223641388820913306353322),
      K(3.6528504162390812088506286539079244108117187590040119e-6),
      K(-6.179158358938431730353503095429364034217627301805927e-7),
      K(8.41760963324416263997775994509260475048263253783024e-8),
      K(-8.5092914422998531424745438268217242647028585648097e-9),
      K(5.046317271957164055615983632198166484671800771169e-10),
      K(8.9203975558846874163114608473958278918704288383e-12),
      K(-5.3805477301538744660414502792769578669672344109e-12),
      K(5.447733339659165213895452907627588726899836668e-13),
      K(-2.58782557959074664071329659550113237457105563e-14),
      K(5.303502041610639946563056139986220169978485e-16),
      K(-3.5445741885366539074944671234695566351428e-18),
      K(3.32451022493578215977426613208624892834e-21)
    };
  #elif LDBL_MANT_DIG == 64
    /* long double 96 bit wide */
    static const R P1[] =
    {
      /* Numerator Chebyshev coefficients on Intervall [-1,1], ExtendedPrecision */
//       K(0.5011025194894737249762950649667338995036946052675521960726389969),
//       K(0.0592478071849472777249574550681144646462134620265841966889202709),
//       K(0.0011025663839286478496724001817980561293740243069844307568520155),
//       K(9.6211703569003075527981908959110281112856196539033425225506e-6),
//       K(4.68947291078074698713332293602023200715456251596277854572e-8),
//       K(1.405502152103080550302133932101589934486340973044434306e-10),
//       K(2.74185255219624992839745868142404671452811463767962e-13),
//       K(3.595728348251761215435966211461081971793267233356e-16),
//       K(3.211271661321638496156137940588726028594224547e-19),
//       K(1.939154527052274973738558203815187297901123e-22),
//       K(7.64103276038123905049641530907763913954e-26),
//       K(1.79280427442467791777922871157205292e-29),
//       K(1.9262775285541606925202162212749e-33)

      /* Numerator Chebyshev coefficients on Intervall [0,225], ExtendedPrecision */
      K(1234.704367835781353935328616743846110593824506711948741522719013),
      K(2030.306407063727922599030922406904814840281241517974581391347243),
      K(1136.967460711407605370869495389120668780488527378529816323307394),
      K(440.660601117953778289984634060120420318842351118102467471952403),
      K(120.245892138741234740566783847069396989738255281235781715301372),
      K(23.42871554522164380233368242994382102790296902186499836999033),
      K(3.287955814338296143836972836867683059995739023547980486559614),
      K(0.332891922314815847913341966097617586119384869956322580368144),
      K(0.024121892422413839103713471761462989503192938087347948021876),
      K(0.001223313327981083761200658561323702952946223794086525740818),
      K(0.000041406895147870974944458938355525555417758403362215521816),
      K(8.44956700325598326898531709248011447407533498601774905e-7),
      K(7.916790047941581673403192414793951158563076875521815e-9)
    };
    static const R Q1[] =
    {
      /* Denominator Chebyshev coefficients on Intervall [-1,1], ExtendedPrecision */
//       K(1.000010722928798495665441608890983115868929236954573623043443331356),
//       K(-0.006562145946394973615560163773013913001339926014702238422073043926),
//       K(0.000010722937993015939330579059250597724167453740435894142688179775),
//       K(-1.1566557894239373766773642549933722084604829394917769959268e-8),
//       K(9.194523087152395811123623152974922024343583064604065569e-12),
//       K(-5.687483788673145412590742399815693047112136848266971e-15),
//       K(2.813263785680077537118123789672786344477954187037e-18),
//       K(-1.123405901854358474421004692784981201803990657e-21),
//       K(3.60037238303449255105332777044115437666947e-25),
//       K(-9.0427932949543166390526763908114131241e-29),
//       K(1.6907629001418751567843656019631058e-32),
//       K(-2.113098854508039658948199035424e-36),
//       K(1.33397853095832053176933998e-40)

      /* Denominator Chebyshev coefficients on Intervall [0,225], ExtendedPrecision */
      K(0.545092588130655919583212144380829425127577869856795714420824279),
      K(-0.377626304800423417630269058642279149476224387065539283018291391),
      K(0.068214806731120390317448128653699012521639381789852916732667222),
      K(-0.00826439174615006492824438536258659792435665752404920989928758),
      K(0.000745811573955314736237406358154928801207887580166169038355677),
      K(-0.000052912285167944471067901189664539605252933893690498866366544),
      K(3.036462294613356329548360657690645106247540128803564546302e-6),
      K(-1.42628761089160855099710042044001394859821381209138259902e-7),
      K(5.469528626296796615567283410637705521927025164379630367e-9),
      K(-1.67934589042439866725429370421953210757708169522394262e-10),
      K(3.943443749405563669760385743026599470847545060376054e-12),
      K(-6.403847710206347705290450300699275341669903896235e-14),
      K(5.48250592217902560540591547450019398617320038067e-16)
    };
    static const R P2[] =
    {
      /* Numerator Chebyshev coefficients on Intervall [-1,1], ExtendedPrecision */
//       K(9.22285735229236481768431707758020618680907805241821282904009067e7),
//       K(-1.760102082337114866827281688988230506891712215388060190850021277e8),
//       K(1.486537861414841414892148698068735244818252681128443619982492459e8),
//       K(-1.138900663553407157060471622789561270263774505838356915991936584e8),
//       K(7.65138563072253971717356016023064812610089598218627948030493616e7),
//       K(-4.60093476814924566370107011035275431471461126017644541236990467e7),
//       K(2.37221177449908291416122199024072237343810433051378619885334915e7),
//       K(-1.05826096610971550497104845840845710852724539071194694697380874e7),
//       K(3.8600126410366211502537319272803399266062707024706857365349672e6),
//       K(-1.0977008707312795406770065921156213051374945203451354135036141e6),
//       K(226538.1857684154665727366561624000871822266036616463880786306),
//       K(-17068.46968725869752207113329704231842241795119561991017923)

      /* Numerator Chebyshev coefficients on Intervall [0,1/15], ExtendedPrecision */
      K(0.09526906064503932541831157803447521609166794086983442038332549),
      K(-0.15694163988730460433313657947685125129911270171356143585151157),
      K(0.09236482280169699396191342586266854922889018657945291466367493),
      K(-0.03925463546271390594499561833368996640678225965985261247733043),
      K(0.01207392253328417036672407185847223127909661005541267434021355),
      K(-0.00261968742865439488772881601519138996610532598355524200779816),
      K(0.00038220308581532031148560729920223980090585297368886934658389),
      K(-0.0000342535057255439973090488827046082482401987199104757268379),
      K(1.66973322662784517077896060521332107190992425113440844186e-6),
      K(-3.877976437986556582061575174918163697004714189279264787e-8),
      K(3.6244641753202414763342597032145868956972169444987036e-10),
      K(-9.6351851989053361146128375373358693401156451829213e-13)
    };
    static const R Q2[] =
    {
      /* Denominator Chebyshev coefficients on Intervall [-1,1], ExtendedPrecision */
//       K(1.781172089273504092882979591922050712852437989588607848669543885e8),
//       K(-3.430589981098070830893777012374519954905687400492505894681986815e8),
//       K(2.857106161743549012550897647280092541038854472367871117151713858e8),
//       K(-2.201152214379810198911970783992065887106095203615815225023549353e8),
//       K(1.447247596164542370997501673530183237345919573262340536620852036e8),
//       K(-8.71978073524975291534863562260181282124503356862319488083860883e7),
//       K(4.33931822229173765609808791435445877633668518947586626001182913e7),
//       K(-1.92801184172138325087934784204104297853071479728312721074826826e7),
//       K(6.5774693838337813154021558468520164292778279922187287888624308e6),
//       K(-1.8175752126049721612608131548460357609291406297517005923742407e6),
//       K(315638.5303661498873796385205215695818612851457677930026123457),
//       K(-9057.4684647563698849341065401797671599708601942887404999519)

      /* Denominator Chebyshev coefficients on Intervall [0,1/15], ExtendedPrecision */
      K(0.23933715665417852859782867863506302676724376835566267954152413),
      K(-0.39388072312366082993706684161033979592417519115327549448467534),
      K(0.23133949949676026299331643708756933629486335212544841094956822),
      K(-0.09798644593570400042855851406040463791014241264866609536662813),
      K(0.02998674941280985258485470389951208990925421807560535306987906),
      K(-0.00645447760319519200085200348774256007779275282629915611122216),
      K(0.00092911510447500480182729660519792303579579562479610823250163),
      K(-0.00008114746375524401309951913987877676274903948328194748450942),
      K(3.74399230228408392042822871661620902806619476723282117401e-6),
      K(-7.670782165334159140933791332333828644780540631461839954e-8),
      K(5.2328730771857463046927186463606166383974444475116728e-10),
      K(-5.1129590227012659819839207937410094269935217984472e-13)
    };
  #else
    #error Unsupported size of long double
  #endif
#elif defined(PNFFT_SINGLE)
  /* float */
  static const R P1[] =
  {
    /* Numerator Chebyshev coefficients on Intervall [-1,1], SinglePrecision */
//     K(0.5010318718351607695456894172495763858762190925031159343505976836),
//     K(0.0580429352976888313594266025851422645066131479873259595903711531),
//     K(0.0010319077433084983380151565103035620577704237263311584250883742),
//     K(8.3271455240638732650287019279137042011257612532576320380096e-6),
//     K(3.59082855999925899677189530829953898533345653396970605268e-8),
//     K(8.92784128374385587746248025019149178134315614987235715e-11),
//     K(1.304937084085366587663343792485616489852656829832261e-13),
//     K(1.068644686681132838884954318081674984806302519246e-16),
//     K(3.94395946850910264848252333201754454829678128e-20)

    /* Numerator Chebyshev coefficients on Intervall [0,225], SinglePrecision */
    K(739.3351835190990919146121188473593246164830740143862598536185982),
    K(1190.830962901119421329111285982414078672727287626780004374070303),
    K(626.1461833423268980335699362370387843408264207493321304672970812),
    K(217.2833574024998941536529661438974141083109582827442445423030042),
    K(50.0132778335346194962202544488178526869739913911447978402378087),
    K(7.5679682283463356551742538916498131176878169424776113098307172),
    K(0.7271954132014320193329179818990599689893835350329628927365339),
    K(0.0405635112091777983029389199008359101577571264958116509403081),
    K(0.0010119350127948500375127092316707945303654823840611186768647)
  };
  static const R Q1[] =
  {
    /* Denominator Chebyshev coefficients on Intervall [-1,1], SinglePrecision */
//     K(1.000019617347948489409452540176003005458848136052359109715010411632),
//     K(-0.008964173654320418625066449705269964476033575858515462547905473405),
//     K(0.000019617374748560223123378349576400601894042528641095037136925002),
//     K(-2.7423165841282304545282208090941943498620846607036324638285e-8),
//     K(2.6800079946635026597650689780936835334546057699437449945e-11),
//     K(-1.8737752752093029550005224243703885188226198795586941e-14),
//     K(9.132964611185545844343288249752696850132414928158e-18),
//     K(-2.82624121676146106955124288910799556031312492e-21),
//     K(4.22761468549705397320894432777755103991584e-25)

    /* Denominator Chebyshev coefficients on Intervall [0,225], SinglePrecision */
    K(0.461147563880136789506077191049236424138137450732375887375920196),
    K(-0.418679073054139623894187094918938511895989526041327263602892319),
    K(0.101648476828995914548663855179087431988567248077972231340223593),
    K(-0.016422192139318825872917999085312976815505204095675571649715425),
    K(0.001923358692973667608887777446322991690501316810104897006280138),
    K(-0.000168060865683973777934663589053840650604244254669632352687999),
    K(0.000010792665891422664039161402381069791319426190589475356482349),
    K(-4.71025711491129880725722342797590476205109139257121174061e-7),
    K(1.084714829099741153160732395543889937868814578419462392e-8)
  };
  static const R P2[] =
  {
    /* Numerator Chebyshev coefficients on Intervall [-1,1], SinglePrecision */
//     K(1.70619810693317130998035771612923603436836080587303785286183642),
//     K(-2.665793872572952743983336532890316549731447096923955629937030573),
//     K(1.307255826531925552377992575315672834248470666612093411158711976),
//     K(-0.191117748557026352524823396572456710763534638303379184411594771)

    /* Numerator Chebyshev coefficients on Intervall [0,1/15], SinglePrecision */
    K(0.3334809845421506158670316667252795771495366217795015779609185552),
    K(-0.0640441610689900932799437436099727411871671141931359176496836947),
    K(0.0014100354337525945025466546986792774092420996780194881755176122),
    K(-7.0784319464463852707536050844201375850930428361976461140822e-6)
  };
  static const R Q2[] =
  {
    /* Denominator Chebyshev coefficients on Intervall [-1,1], SinglePrecision */
//     K(3.422278695984590960933295743676563823535126254718666240544626748),
//     K(-5.295750100080865012420402317173023690165151744020606374376613956),
//     K(2.422278695984590960933295743676563823535126254718666240544626748),
//     K(-0.141926420370323808280904373644801379970146618470160079190660935)

    /* Denominator Chebyshev coefficients on Intervall [0,1/15], SinglePrecision */
    K(0.845689312132915623338072149012029099009540522404396668956483841),
    K(-0.151645501869559938127244012670011616530583984073137097043605419),
    K(0.0026598807660941835054988848408955777206325730927013172536449547),
    K(-5.2565317223497859877069126824497169630295779161584647354805e-6)
  };
#else
  /* double */
  static const R P1[] =
  {
    /* Numerator Chebyshev coefficients on Intervall [-1,1], DoublePrecision */
//     K(0.5010717117099655910245580663484436014329393122542164986097899767),
//     K(0.058724667569273258856515178936892780824741943509353153875970281),
//     K(0.0010717536850875205783085318233309565065651958736291795185983543),
//     K(9.0513572140352383029155586373957878263025628541027106687118e-6),
//     K(4.19753273119501607813491818249579455779605580405028899312e-8),
//     K(1.169774114076823840172677849677459466360793564786930126e-10),
//     K(2.053825542152973308510710580416840989052859749135995e-13),
//     K(2.307792356316127650706955976618798326920412358468e-16),
//     K(1.628916089280852456712474184936936033746461316e-19),
//     K(6.68394030838520348740119306081146482689995e-23),
//     K(1.24334672872950431280846973437899126901e-26)

    /* Numerator Chebyshev coefficients on Intervall [0,225], DoublePrecision */
    K(992.2172774942673117233772097178701000484211800514759244184220915),
    K(1618.088475477247318120934809576415018587593709701730400022061576),
    K(883.683500208215821879830421948934507423822411060746308174214217),
    K(327.968952700289053118313685250300475594816929012886884485465471),
    K(83.857822925475408977534998763390049894939395140633596732520018),
    K(14.887461438658739746950039327358312447355373624619235635811546),
    K(1.831765471717483418989578933005745144634966986483136237451339),
    K(0.153626199868636072239830333174240889070551155559376065717587),
    K(0.008419362204753433503393982922511580331034076464416284379094),
    K(0.000273683363006525477919293548720427191612964683326449964302),
    K(4.037545974150685767049711915211081671444327077145237624e-6)
  };
  static const R Q1[] =
  {
    /* Denominator Chebyshev coefficients on Intervall [-1,1], DoublePrecision */
//     K(1.000014315691427411385932345530198993600492291215975576257981967511),
//     K(-0.007605024671496122648480460085937521140222676604880742944765879136),
//     K(0.000014315707145829359157225257397923758975796983075070462525660934),
//     K(-1.7612194193706530878066317509420216394345315198601736799907e-8),
//     K(1.5718423534727545818943177590564530933716017694814964104e-11),
//     K(-1.0653793715886847428730158259448530388128320907509747e-14),
//     K(5.561503305142970619141441184071386041567313958309e-18),
//     K(-2.209348490924794851079069462328758329211879206e-21),
//     K(6.39051237835573548494151656984906691450458e-25),
//     K(-1.2136951233096225186982051042041889636e-28),
//     K(1.146386418833524688746682964876283e-32)

    /* Denominator Chebyshev coefficients on Intervall [0,225], DoublePrecision */
    K(0.505595102183738644583491006011798500910241167993303523739359498),
    K(-0.39871140822309335507225969711138857759391835459917139738103615),
    K(0.082875006561462043193069136717435320644196357894125880314714393),
    K(-0.011532247068036979293238109299384326939688699857820468661414997),
    K(0.001185640602309395043172618762916639251842450638954252587900381),
    K(-0.00009437326671786761918524025302339524871240316725101921146347),
    K(5.920121343433062281611472207522895876856944712444517204683e-6),
    K(-2.90895722730383106516375392460321973731335358045453904009e-7),
    K(1.0797972544347747465543851452476879034576082171644211121e-8),
    K(-2.75880322681259059969494048381229101604012509059193938e-10),
    K(3.722684721189538483107755335441841389208287429597361e-12)
  };
  static const R P2[] =
  {
    /* Numerator Chebyshev coefficients on Intervall [-1,1], DoublePrecision */
//     K(564390.068294938872573047521016219542605726068055799424120731267),
//     K(-1.065004548314074649893929560942940945485315728050900505302542134e6),
//     K(861980.1087588597205674112951766723578135637567693660052527062),
//     K(-616405.215805470791359480173494341009418378750122140279673218036),
//     K(371591.268295876180497891294758671212937865775176761449152858678),
//     K(-192048.289861241050682109160436135000419708681747559275771499299),
//     K(79899.42323454916633178277819874667907599739277477179239532303),
//     K(-25760.980561715240507611446083112733183609337348916848754422376),
//     K(5898.594344874235260933197482345289503377438886830852592535424),
//     K(-480.1586065999296898244579665102645307239304492514223516727106)

    /* Numerator Chebyshev coefficients on Intervall [0,1/15], DoublePrecision */
    K(0.113065909704387605944266260136135409917531828627923996725252458),
    K(-0.171582127991735737978303530426824001285524679101923904920982916),
    K(0.082951058812627373816747283942656067084281382205730066518830076),
    K(-0.025734783512400298780682466886157350290861465962723581775677376),
    K(0.005013423371628229597760319921197192483540981559581966126327417),
    K(-0.000561674032141677144462002659612385875930343094322641304804732),
    K(0.000032205060424304822789925484662523935762269009126893002635205),
    K(-8.40203170425580564302576581329589724634988542083615344527e-7),
    K(8.551276337607944256116131425104906209091273558683212205e-9),
    K(-2.4394551561560722870222918874043591425613991269731976e-11)
  };
  static const R Q2[] =
  {
    /* Denominator Chebyshev coefficients on Intervall [-1,1], DoublePrecision */
//     K(1.090712715874367659870436385087151279498560115826192036708916382e6),
//     K(-2.084642025029918819831476113368031051247953542334342841411029472e6),
//     K(1.653259477679860274033217827726030038003389437867094943130897497e6),
//     K(-1.190786840875534365963075528386744219788331638592529590699076341e6),
//     K(694019.77937741992999391736307577943202678904005945522338970634),
//     K(-358768.451482436488612975356594542597700288622044785175208473259),
//     K(139987.311565654117311765454726470616888945651912522040363492558),
//     K(-44062.992801210269599071191486447391531576018877467242037471208),
//     K(8515.293993726801480629534289569943366985933893969723395767332),
//     K(-264.362695130792224725241204761712105768171079832504861948166)

    /* Denominator Chebyshev coefficients on Intervall [0,1/15], DoublePrecision */
    K(0.284282750222519327547442212157799218056475210000015389653541916),
    K(-0.43062450283351421869879080126637617726194853110662031168012121),
    K(0.20742422140616522159122663442377779533220840670685474813346306),
    K(-0.06393125781644177228124448773313274346058790248896854788278936),
    K(0.0123134104358670186919802229465306410758482585928277889239366),
    K(-0.00134808050347218649685167417666646544965341687903241088116723),
    K(0.00007344291502679420053502434406094013860366158127388502987342),
    K(-1.70037221570049137837855198829164914497752171163263880169e-6),
    K(1.273687901973681582338923343978340346286577897345137248e-8),
    K(-1.3430998234078541475580295695857664650888026719616731e-11)
  };
#endif

static const INT N1 = sizeof(P1)/sizeof(P1[0]);
static const INT M1 = sizeof(Q1)/sizeof(Q1[0]);
static const INT N2 = sizeof(P2)/sizeof(P2[0]);
static const INT M2 = sizeof(Q2)/sizeof(Q2[0]);

static inline R evaluate_chebyshev(const INT n, const R *c, const R x)
{
  R a = c[n-2], b = c[n-1], t;
  int j;
  
  A(n >= 2);
  
  for (j = n - 2; j > 0; j--)
  {
    t = c[j-1] - b;
    b = a + K(2.0) * x * b;
    a = t;
  }
  return a + x * b;
}

R PNX(bessel_i1)(R x)
{
  if (x < 0)
  {
    /* even function */
    x = -x;
  }

  if (x < PNFFT_EPSILON)
    return K(1.0);

  if (x <= K(15.0))
  {
    /* x in (0, 15] */
    const R y = x*x/K(112.5) - K(1.0); /* use this if the Chebyshev approximation was computed on [0,225] */
//     const R y = x * x; /* use this if the Chebyshev approximation was computed on [-1,1] */
    return x * evaluate_chebyshev(N1, P1, y) / evaluate_chebyshev(M1, Q1, y);
  }
  else
  {
    /* x in (15, \infty) */
    const R y = (K(30.0) - x) / x; /* use this if the Chebyshev approximation was computed on [0,15] */
//     const R y = K(1.0) / x; /* use this if the Chebyshev approximation was computed on [-1,1] */
    return (pnfft_exp(x) / pnfft_sqrt(x)) * (evaluate_chebyshev(N2, P2, y) /
      evaluate_chebyshev(M2, Q2, y));
  }
}

